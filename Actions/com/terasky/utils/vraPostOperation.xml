<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="vraPostOperation" result-type="string" api-version="6.0.0" id="614d2e92-6293-40c6-935a-7d695200976f" version="0.0.0" allowed-operations="vfe" category-name="com.terasky.utils">
  <param n="pathUri" t="string"><![CDATA[]]></param>
  <param n="payload" t="string"><![CDATA[]]></param>
  <script encoded="false"><![CDATA[for each(var host in Server.findAllForType("VRA:HOST"))
{
    if(host.name.toLowerCase() == "verint-vra")
    {
        break;
    }
}
var inputHeaders = {
    "content-type":"application/json"
}

var restClient = host.createRestClient();
var request = restClient.createRequest("POST", pathUri, payload);
var keys = inputHeaders.keys;
for(var key in keys){
    request.setHeader(keys[key], inputHeaders.get(keys[key]));
    System.log("Value for key: "+keys[key] +" is: "+inputHeaders.get(keys[key]));
}
var response = restClient.execute(request);

System.log("******Rest Response***** ");
statusCode = response.statusCode;
System.log("Status code: " + statusCode);
statusCodeAttribute = statusCode;
statusMessage = response.statusMessage;

System.log("Status Message: " + statusMessage);
contentAsString = response.contentAsString;
content = JSON.parse(contentAsString)
System.log("Content as string: " + contentAsString);
headers = response.getHeaderValues("Access-Control-Allow-Headers");

System.log("****Headers****");
for each (var header in headers){
	System.log(header.toString());
}

System.log("****All Headers****");
for each (var header in response.allHeaders){
	System.log(header.toString());
}

if ( statusCodeAttribute >= 400 ) {
    System.log(content.message)
    if(content.message.search("Input date is later than the maximum allowed") > -1)
    {
        throw content.message
    }
	throw "HTTPError: status code: " + statusCodeAttribute;
} 

return contentAsString]]></script>
</dunes-script-module>