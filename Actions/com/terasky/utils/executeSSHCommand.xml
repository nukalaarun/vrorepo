<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="executeSSHCommand" result-type="string" api-version="6.0.0" id="02744145-d9eb-48eb-aee7-a57978420526" version="0.0.0" allowed-operations="vfe" category-name="com.terasky.utils">
  <param n="cmd" t="string"><![CDATA[]]></param>
  <script encoded="false"><![CDATA[var hostName = "172.16.25.10"
var username = "root"
var passwordAuthentication = true
var password = "Bpovtmg1!"
var path = "/var/lib/vco/app-server/conf/vco_key"
var port = 22
var encoding = ""

var session = null;
try {
	if (port) {
		session = new SSHSession(hostName, username, port);
	} else {
		System.log("A port value is not provided! Using default port 22");
		session = new SSHSession(hostName, username);
	}

	if (passwordAuthentication){
		System.log("Connecting with password");
	} else {
		if (path == null || path == ""){
			System.log("using default");
			path = defaultKeyPairPath;
		}
		System.log("Connecting with key pair (" + path + ")");
		password = passphrase;
	}

	session.connectWithPasswordOrIdentity(passwordAuthentication, password, path);
	System.log("Connected!");

	System.log("Executing '" + cmd + "' using encoding '" + (encoding ? encoding : "Default System Encoding") + "'");
	session.setEncoding(encoding);
	session.executeCommand(cmd, true);

	output = session.getOutput();
	error = session.getError();
	exitCode = session.exitCode;

	System.log("Output: '" + output + "'");
	System.log("Error: '" + error + "'");
	System.log("Exit code: '" + exitCode + "'");

} catch (e) {
	throw "Unable to execute command: " + e;
} finally {
	if (session) {
		session.disconnect();
	}
}


if(exitCode == 0)
{
    return output
}
else
{
    throw "Something went wrong while trying to execute SSH commamnd against: " + hostName
}]]></script>
</dunes-script-module>