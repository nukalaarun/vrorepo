<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="updateMachineProperties" result-type="string" api-version="6.0.0" id="1c9fffee-d054-4ca8-8dd7-c83c0689b883" version="0.0.0" allowed-operations="vfe" category-name="com.vmware.pscoe.rba.migration">
  <param n="machineId" t="string"><![CDATA[]]></param>
  <param n="properties" t="string"><![CDATA[]]></param>
  <script encoded="false"><![CDATA[var __global = System.getContext() || (function () {
    return this;
}).call(null);

var VROES = __global.__VROES || (__global.__VROES = System.getModule("com.vmware.pscoe.library.ecmascript").VROES());
var ClientsFactory = VROES.importLazy("com.vmware.pscoe.rba.migration/ClientsFactory");
var MachinesService = VROES.importLazy("com.vmware.pscoe.ts.vra.iaas/services/MachinesService");

var vraClient = ClientsFactory._.ClientsFactory.getVraClient();
var machinesSvc = new MachinesService._.MachinesService(vraClient);


var updateMachineSpecification = {
    tags: [],
    description: "",
    customProperties: properties
};
var updateMachineParameters = {
    path_id: machineId,
    "body_body": updateMachineSpecification
};

var response = machinesSvc.updateMachine(updateMachineParameters);

if (response.status < 200 || response.status >= 300) {
    throw new Error("Unable to set properties for machine " + machineId + ". Error: " + response.status + " " + response.body.message);
} else {
    System.log("Successfully updated VM properties.");
}]]></script>
</dunes-script-module>